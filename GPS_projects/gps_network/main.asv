clc;clear all;format long g;
%There are five point and 402 is a Fix point
syms x309 x311 x315 x401 y309 y311 y315 y401 z309 z311 z315 z401 
%Convert Geodetic coordinate to Catesian
[X0_402,Y0_402,Z0_402]=G2C([47 22 45.13567],[9 40 13.25647],460.223);
[X0_309,Y0_309,Z0_309]=G2C([47 23 42.1315],[9 39 06.7501],454.6084);
[X0_315,Y0_315,Z0_315]=G2C([47 23 2.52377],[9 38 20.12157],461.3014);
[X0_311,Y0_311,Z0_311]=G2C([47 23 12.44956],[9 38 14.81397],454.8585);
[X0_401,Y0_401,Z0_401]=G2C([47 23 33.30053],[9 40 04.10243],456.5356);
X0=[X0_309 Y0_309 Z0_309 X0_311 Y0_311 Z0_311 X0_315 Y0_315 Z0_315 X0_401 Y0_401 Z0_401];
%Equation daltax,deltay,deltaz
K=[x309-x401 ;y309-y401;z309-z401; x311-x315; y311-y315;z311-z315;x401-x315; y401-y315;z401-z315; x311-x309; y311-y309;z311-z309;x315-x309;...
   y315-y309;z315-z309; x315; y315; z315; x401; y401; z401;x309;y309;z309] ;
Kx=[x309 y309 z309 x311 y311 z311 x315 y315 z315 x401 y401 z401];
A=jacobian(K,Kx);A=eval(A);
%Observation
l=[2.6393;-1219.6757;183.2147;-208.083; -148.2635; 202.817 ;-1058.5529;2032.2342;640.0422;847.839;-960.8186;-620.4315;1055.9127;-812.5601;-823.2508;...
 9.141+X0_402;-2405.8049+Y0_402; 364.4223+Z0_402; -1049.413+X0_402;-373.5771+Y0_402;1004.4573+Z0_402;-1046.7687+X0_402;-1593.2419+Y0_402;1187.679+Z0_402];
%Wheight matric
Q1=0.1881*[.00000719,.0000007,.00000616;.0000007,.00000123,.00000055;.00000616,.00000055,.00000867];
Q2=0.1965*[.00000752,.00000175,.00000301;.00000175,.00000177,.00000111;.00000301,.00000111,.00000502];
Q3=0.2703*[.00000851,.00000108,.00000525;.00000108,.00000154,.00000064;.00000525,.00000064,.00000696];
Q4=0.2852*[.0000046,.00000104,.00000228;.00000104,.00000201,.00000616;.00000228,.00000616,.0000204];
Q5=0.2336*[.00000567,.00000117,.00000167;.00000117,.00000178,.00000187;.00000167,.00000187,.0000095];
Q6=0.2704*[.00000443,.00000082,.00000232;.00000082,.00000102,.00000038;.00000232,.00000038,.00000543];
Q7=0.2312*[.00000433,.00000072,.00000235;.00000072,.00000099,.00000052;.00000235,.00000052,.00000672];
Q8=0.2497*[.00000545,.00000096,.0000027;.00000096,.00000143,.00000125;.0000027,.00000125,.00001065];
Q=100*blkdiag(Q1,Q2,Q3,Q4,Q5,Q6,Q7,Q8);
p=inv(Q);
x_hat=inv(A'*p*A)*A'*p*l;
Cx_hat=inv(A'*p*A);
l_hat=A*x_hat;
v_hat=l-l_hat;
sigma02_hat=(v_hat'*p*v_hat)/12;
test_sigma02(sigma02_hat,100,12,.05);
%**************************************************************************
X0=[X0_309 Y0_309 Z0_309 X0_311 Y0_311 Z0_311 X0_315 Y0_315 Z0_315 X0_401 Y0_401 Z0_401];
x_hat-X0';
diag(Cx_hat);
%**************************************************************************
[std_U,std_N,std_H]=ECEF2local(401,Cx_hat);
%**************************************************************************

 